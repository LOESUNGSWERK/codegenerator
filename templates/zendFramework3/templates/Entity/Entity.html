<?php
/**
 * @copyright  Copyright (c) 2017 TraSo GmbH (www.traso.de)
 * @author     rkuehle
 * @since      11.05.17
 */

namespace {{modulName|ucf}}\Model\{{tableName|ucf}}\Entity;

use {{modulName|ucf}}\Model\{{tableName|ucf}}\Storage\{{tableName|ucf}}Storage;
use Zend\Hydrator\ClassMethods;


/**
 * Class SettingsEntity
 * @package {{modulName|ucf}}\Model\{{tableName|ucf}}\Entity;
 */
class {{tableName|ucf}}Entity
{


    /**
     * @var {{tableName|ucf}}Storage
     */
    private $storage;

    {% if fields|length > 0 %}{% for item in fields %}
    private ${{item.fieldName|lcf}};
    {% endfor %}{% endif %}

    /**
     * {{tableName|ucf}}Entity constructor.
     * @param {{tableName|ucf}}Storage $repository
     */
    public function __construct($repository)
    {
        $this->storage = $repository;
    }

    public function toArray(){
        $help = new ClassMethods();
        return $help->extract($this);
    }

    public function reorg(){
        {% if fieldsByTypes.treePath|length > 0 %}{% for item in fieldsByTypes.treePath %}
            $this->set{{item.fieldName|ucf}}( $this->generate{{item.fieldName|ucf}}() );
        {% endfor %}{% endif %}
    }

    {% if fieldsByTypes.label|length > 0 %}
    private $label;
    /**
     * @return string
     */
    public function getLabel(){
        if ($this->label == null){
            $this->label = '';
            {% for item in fieldsByTypes.label %}
                if (trim($this->get{{item.fieldName|ucf}}()) !=''){ $this->label .= trim($this->get{{item.fieldName|ucf}}());}
            {% endfor %}
        }
        return $this->label;
    }
    {% endif %}


    {% if fields|length > 0 %}{% for item in fields %}
        {% if item.fieldType == "treePath" %}
            {% include 'Entity/FieldTypes/treePath.html' %}
        {% elseif item.fieldType == "boolean" %}
            {% include 'Entity/FieldTypes/boolean.html' %}
        {% else %}
            {% include 'Entity/FieldTypes/default.html' %}
        {% endif %}
    {% endfor %}{% endif %}


    {% if extras.isTree %}

    /**
     * @var XresSettingsUiEntity
     */
    private $parent;

    /**
     * @return XresSettingsUiEntity
     */
    public function getParent(){
        if ($this->parent==null){
            if ($this->hasParent()){
                $this->parent = $this->getStorage()->getById( $this->getParentId() );
            }
        }
        return $this->parent;
    }

    /**
     * @return bool
     */
    public function hasParent(){
        return ($this->getParentId() != null);
    }

    {% endif %}

}